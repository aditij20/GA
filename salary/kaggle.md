Linear Regression and Cross Validation: Kaggle Salary Competition
========================================================

Last week in class we discussed linear regression and covered some of the mathematical background that results in using least squares. $$ y = \alpha + \beta x + \epsilon $$ 


```r
#
# 
# Variables: Id, Title - job description, often including location
# FullDescription - detailed job description LocationRaw -
# LocationNormalized - city ContractType - full_time, part_time, NA
# (almost always full-time according to boxplots) ContractTime -
# permanent, contract, NULL (boxplots very different) Company - recruiting
# company or actual?  Category - job category, e.g. engineering **
# SalaryRaw - salary, often as range (pounds) SalaryNormalized - salaray
# as actual number (pounds) SourceName - URL (of job posting?)

require("plyr", quietly = TRUE)
require("DAAG", quietly = TRUE)
```

```
## Loading required package: RColorBrewer
```

```
## randomForest 4.6-7
```

```
## Type rfNews() to see new features/changes/bug fixes.
```

```
## Attaching package: 'boot'
```

```
## The following object(s) are masked from 'package:lattice':
## 
## melanoma
```

```
## Loading required package: splines
```

```
## Attaching package: 'survival'
```

```
## The following object(s) are masked from 'package:boot':
## 
## aml
```

```
## Attaching package: 'DAAG'
```

```
## The following object(s) are masked from 'package:survival':
## 
## lung
```

```
## The following object(s) are masked from 'package:MASS':
## 
## hills
```

```
## The following object(s) are masked from 'package:plyr':
## 
## ozone
```

```r

setwd("/Volumes/DATA/robert/Desktop/Projects/GA/salary")

df <- read.csv("data/train.csv")
test <- read.csv("data/test.csv")


# Rename some columns to make life easier
df2 <- df

df2 <- rename(df2, replace = c(LocationNormalized = "City"))
df2 <- rename(df2, c(SalaryNormalized = "Salary"))
test <- rename(test, c(LocationNormalized = "City"), warn_missing = TRUE)


# Remove *** and city from description
df2$city <- as.numeric(as.factor(df2$City))
df2$category <- as.numeric(as.factor(df2$Category))
df2$ctime <- as.numeric(as.factor(df2$ContractTime))
df2$ctype <- as.numeric(as.factor(df2$ContractType))
df2$company <- as.numeric(as.factor(df2$Company))


test$city <- as.numeric(as.factor(test$City))
test$category <- as.numeric(as.factor(test$Category))
test$ctime <- as.numeric(as.factor(test$ContractTime))
test$ctype <- as.numeric(as.factor(test$ContractType))
test$company <- as.numeric(as.factor(test$Company))



# Code the categories

salary.glm <- glm(Salary ~ city + category + ctime + ctype + company, data = df2)
summary(salary.glm)
```

```
## 
## Call:
## glm(formula = Salary ~ city + category + ctime + ctype + company, 
##     data = df2)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -29109  -10109   -3829    6038  137961  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 28335.886    642.377   44.11  < 2e-16 ***
## city            1.241      0.601    2.07    0.039 *  
## category     -169.583     26.303   -6.45  1.2e-10 ***
## ctime        4631.938    169.310   27.36  < 2e-16 ***
## ctype       -1482.168    261.217   -5.67  1.4e-08 ***
## company        -5.617      0.426  -13.18  < 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for gaussian family taken to be 241149598)
## 
##     Null deviance: 2.609e+12  on 9999  degrees of freedom
## Residual deviance: 2.410e+12  on 9994  degrees of freedom
## AIC: 221396
## 
## Number of Fisher Scoring iterations: 2
```

```r

plot(predict(salary.lm, test))
```

```
## Error: object 'salary.lm' not found
```

```r

cv.glm(df2, salary.glm, K = 10)
```

```
## $call
## cv.glm(data = df2, glmfit = salary.glm, K = 10)
## 
## $K
## [1] 10
## 
## $delta
## [1] 241266046 241252305
## 
## $seed
##   [1]         403           1 -2087317009  1782561270 -1707892960
##   [6]  -633638685   -72505983 -2102737936  1642629774  1362910713
##  [11]  -541466741 -2007442502   819479228  -397895169   841041749
##  [16]  -880213908  -504441662  -847118563 -1739180649  -830298882
##  [21]   659697336 -1741385573   135372537  1935454280 -1683504266
##  [26]  -484747599  -718326045   730318258  -815501820  -987904697
##  [31] -1438105571 -1526577516  1571049018  1149108357   533611871
##  [36]  1895902694  -224066448  1669879699 -1599692751  1901096672
##  [41]  -220199042  2120269321  -410937797    68839434   589387756
##  [46] -1511793553  -687017051  1621119836    85073714  1109085741
##  [51]   640386279 -1008237042  -580314136 -1261689365   527478409
##  [56]  -320700904 -1660996282  -203398239  1023790643  -171138142
##  [61]  -277776748   636458263   177943309 -1723522524   577858058
##  [66] -1325018251   160036559 -1654384170  1689302400 -1667273277
##  [71]  1282673505  1818120656  -822245074  1044467929    94612203
##  [76] -1246103718   355971356   274077727 -1238670219    78070028
##  [81] -1909682974  -726514243  1525289527  -298712866  1066003480
##  [86]    -8694917  1388716825   493764520  -176890026   769943505
##  [91]  1601287043  -337758702  1773638052  -576043673  -876975427
##  [96] -1334547916  1239888282 -1300623899   979896703 -1958223610
## [101]  1695210128  1867385651  1161998545   898491008   691131230
## [106]  -443252567 -1156676773 -1278185110  -200780788   139719759
## [111] -1368947451  1447486908   425898130  -680975475 -2026105913
## [116]  1578592430 -1284822776  -504277237   894267881 -2130151752
## [121]  -513015450   408535553  -936182637   242132802  1218361588
## [126] -1610337033 -1636856595 -1033576572  -460033622 -1777981675
## [131]  1543959983   812866998 -1021320224   855337763  1555975233
## [136] -1995702480  -596677298 -1712574535   401238475 -2010871174
## [141]  1427931004 -1245130817 -1494239083   923264684  -495455102
## [146] -2064288675  -696624297   560989758 -1991275912  1995348315
## [151]   -61581127  -331294456  1535855542  1752172785   992304931
## [156]  -476329614 -1668449340  -810731641   542907741  2137404244
## [161]  1538369914    11068613 -1557883361  -304250458 -1203801296
## [166]  -146521645  1098508273 -1824653024  1193238462 -1724452919
## [171]  -999202949  -694459062  1374515628   660401327  1531049573
## [176]  1462701596 -1749606286   873395949  -379897049  2084747086
## [181]  1944584104 -1172673621 -1858475831   670478552   -39473786
## [186] -1201191839 -1171585549 -1970092958 -1603747116 -1746844713
## [191]   932633037 -1028600476 -1977882294   301658293  -924968945
## [196]  -702877418 -1252258880  -539850877  1876600225   302721424
## [201]  -439283090  -278559719 -1413089109  -659059558  1795558492
## [206]  -349955745   290384693 -1593954612  -305243102  1593204349
## [211]    19358583  -421299042   -65696936  1667509947 -2145955751
## [216]   325440488   635205142 -1540466287 -1195296189 -1399195310
## [221] -1926074908 -2016021465  1279467645   113110388   335937882
## [226]   639051685 -1878554689 -1241564090  2101471952  -848940990
## [231]   -90519136  -918538564  1608809936  -252101278  1824950248
## [236]  1357197260 -1767423236 -1279937038  1082264704   745609460
## [241]   372955784  1029466938  1013745488  -163505556   662444180
## [246]  -261430958  1942189792   215697100  1056352416   789981058
## [251] -1253980440 -1650184468   197390396  -566647182 -1535814544
## [256]  -193140188  1231165496 -2070138854    98559696  1874197564
## [261]  -313693036   423266434  -430731328 -1766565572 -1703905648
## [266]  -917561310 -2083039224 -1021916020  -242838500 -1304876398
## [271]  -566333312  1418064916   868845864  -583013830 -1518373680
## [276]   666170476    -1065292   195168274  1521248224  -279964724
## [281]  1224592864  1312014882   432504104   -95095540  1518235196
## [286]  1888592114  1962503920 -1453699260  -524550568    59349562
## [291]  1603133168   513118396  1992516116   725968066   388248672
## [296]   440229244  1893957840   415953954 -1166201176  -508181620
## [301] -1274667588  1091079218  2018600768  1826518196  -843421880
## [306]  -278398278 -1735041264  -678564628  1435653204  1392856850
## [311]  1320667040  1131713484   270713696   748917954  -574368216
## [316]   -47893076  -915600580   707778418   511612720  1959417380
## [321]   217625656  -861925158   732882320  1727441660   437330836
## [326]    15427394   609881600   568301116  -166094256  1206101666
## [331]  -217021624   513798668  1945102556 -1587467694   718278784
## [336]   -18027692  -949488152   -76398854 -1212404912  1906940972
## [341]  1725426036 -1622780270 -1814294944  -609622388  1626605408
## [346]  1836575458   601387176 -2050069300 -1038351876 -1892511822
## [351] -1020016144   199398852  2095520600 -1973915782   831161776
## [356]  -614996548  1563829332   807638978  -886589664 -1915982916
## [361]  -832633264   216369634   405456232  -205832884   636663036
## [366]  1769482994   451838720   488500852  1650914312  -583677510
## [371]  -657173552  -265837076   303828884  -330555694  -587539872
## [376] -1053065908 -1030901472  -757444990   543925736   281150444
## [381] -1144178116  1982056050  1743887216  -333508316  1764323896
## [386]   569047450  -340472368  1737969084  -802614124  -124061566
## [391]  1701625280  -766775492   689266832    29551394  1752451592
## [396]   360286476   197962140 -1695569390  1119489920  1430342420
## [401] -1983250136  1789347898 -1510474800 -1175720340  -908013004
## [406] -1082890606  -332448416  1461193036  1953797088  -434781790
## [411]  -350447192 -1671965044  1528430012 -1378364814  1886481392
## [416] -1287372220  1397993560  1903535162   338695280  -847485892
## [421] -1251801836   -75199806    81442528 -1359442820  1136331472
## [426]  1397770658   -29508568  -708794612   799739324  -974895310
## [431]  1726287552   559329332  1787596488   281561274   190358160
## [436]  -959250708  -620873132   408350354  1306758432 -1051048500
## [441]  -829067552  -839416638  -702776280    26637228   711847612
## [446]  -961669134   664525360 -1031535708  1479724472  1296731994
## [451]  -562536304  1320652668  -845982444 -1291695806  1255216384
## [456]   554607036   701587937  -401757549  1715437748   811897282
## [461]   733641175   174073377 -2105385498  -822323996  1570434069
## [466]   461646911  -517389352  1518409206 -1355262461   191123781
## [471]  1951323490  1630299856   172016121   129720619 -1594316132
## [476]   487407818 -1242633793 -1448583927  1534189086  1264567244
## [481]   412733853  -687854553   166761040   206765806   388183963
## [486]   622052861  -221038358 -1322415224  -868006607 -1845494365
## [491]  1190480292 -1760555950   117946279  -999373839   580450102
## [496] -1783508012  2105555301 -1970322065  -904325208  1588583686
## [501]  1699931187  -847363435  -264064270  -721306816  -294219607
## [506]  1209111835  1815474924  1078587130  -702996689  1279221561
## [511]   807625038  1815592860  -470225651  1938536311  1440347008
## [516] -1934988834  -590410069  1999917485 -1616796134  1996896472
## [521] -1187003071  1370631667   -64742380  1824514466  -912484681
## [526] -1399095167    50854022  -313045820  -524719627  1384285279
## [531]  -998066504 -1326295146   407317923 -1275858587   672135298
## [536]   428225008 -1859172455   952738187 -1360077700     3962538
## [541] -1741164321  -807070103   622969982   -28947348 -1800385347
## [546]   305350023  -847322768   109515790   371501371  1467282973
## [551]  -556610870  1920566760  -883012911   611997379  -268640828
## [556] -1288095118   -41360569 -1398187247 -1213167978  1794825204
## [561]  1691575685   359282895    59314632 -2048225178  1015678611
## [566]  -235334155 -1595430958  1719170080  1388094985 -1067876549
## [571]  1532572300   756262682  -228267633   601425625   375802222
## [576]   -38759172    67006061 -1268667881  -853958688  1296047038
## [581]   771602827   347286029   780404282  2130767480  -780466655
## [586] -1070556973  1782015988 -2012860286 -1041848041   731242465
## [591]  1415166246   521951268 -1337836843    22972031  -441481448
## [596]   990316086  2059884739  -612584187    31571106   129475216
## [601]   167931449 -1620717845   382357468 -1455992310   780793087
## [606]   880795977 -1450011938  -101416820 -1639049123  1144854119
## [611]  1847166864  1637534638 -1458802085 -2075087299 -1468272470
## [616]  -416100024   834131313  1361715939   445016548  1571243282
## [621] -1126434585    49692337 -1821580042   126277396  1568350245
## [626] -1703299160
```

```r


# Calculate MAE (mean absolute error)

```


Interpretation of cross-validation results:

# Bias-variance tradeoff in estimating error with k-fold cross validation
#- K large: lower bias (large training sets), higher variance (training sets similar)
#– K small: higher bias (small training sets), lower variance (training sets less similar)



```r
plot(cars)
```

![plot of chunk unnamed-chunk-2](figure/unnamed-chunk-2.png) 


